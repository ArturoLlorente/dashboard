<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Server Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>

<body>
  <div class="container">
    <div class="header">
      <div class="title">
        <h1>Server Dashboard</h1>
        <div class="subtitle">Real-time system monitoring & control</div>
      </div>

      <div class="top-right">
        <div class="battery-hero" title="Battery status">
          <div class="battery-left">
            <div class="battery-big">
              <span class="pct" id="battery-hero-pct">--%</span>
              <span class="arrow" id="battery-hero-arrow">‚Ä¢</span>
            </div>
            <div class="battery-sub" id="battery-hero-status">--</div>
            <div class="battery-sub" id="battery-hero-estimate" style="font-size:11px;opacity:.7;"></div>
          </div>
          <div class="battery-bar"><div id="battery-hero-bar"></div></div>
        </div>

        <div class="chip">
          <span class="dot" id="status-dot"></span>
          <span>Last update:</span>
          <span id="last-update">Never</span>
        </div>
      </div>
    </div>

    <!-- Quick Stats Bar (always visible) -->
    <div class="quick-stats">
      <div class="quick-stat">
        <div class="quick-stat-icon">üñ•Ô∏è</div>
        <div class="quick-stat-content">
          <div class="quick-stat-label">CPU</div>
          <div class="quick-stat-value" id="quick-cpu">--%</div>
        </div>
      </div>
      <div class="quick-stat">
        <div class="quick-stat-icon">üíæ</div>
        <div class="quick-stat-content">
          <div class="quick-stat-label">Memory</div>
          <div class="quick-stat-value" id="quick-mem">--%</div>
        </div>
      </div>
      <div class="quick-stat">
        <div class="quick-stat-icon">üå°Ô∏è</div>
        <div class="quick-stat-content">
          <div class="quick-stat-label">Temp</div>
          <div class="quick-stat-value" id="quick-temp">--¬∞C</div>
        </div>
      </div>
      <div class="quick-stat">
        <div class="quick-stat-icon">üíø</div>
        <div class="quick-stat-content">
          <div class="quick-stat-label">Disk</div>
          <div class="quick-stat-value" id="quick-disk">--%</div>
        </div>
      </div>
    </div>

    <div class="main-layout">
      <!-- Sidebar Navigation -->
      <div class="sidebar">
        <div class="sidebar-title">Navigation</div>
        <div class="nav-item active" data-window="metrics" onclick="switchWindow('metrics')">
          <span class="nav-icon">üìä</span>
          <span>System Metrics</span>
        </div>
        <div class="nav-item" data-window="controls" onclick="switchWindow('controls')">
          <span class="nav-icon">‚öôÔ∏è</span>
          <span>Controls & Services</span>
        </div>
        <div class="nav-item" data-window="rally" onclick="switchWindow('rally')">
          <span class="nav-icon">üöê</span>
          <span>Rally Bot</span>
        </div>
        <div class="nav-item" data-window="tmux" onclick="switchWindow('tmux')">
          <span class="nav-icon">üñ•Ô∏è</span>
          <span>Tmux Sessions</span>
        </div>
        <div class="nav-item" data-window="terminal" onclick="switchWindow('terminal')">
          <span class="nav-icon">üíª</span>
          <span>Terminal</span>
        </div>
      </div>

      <!-- Content Area -->
      <div class="content-area">
        <!-- System Metrics Window -->
        <div class="window active" id="window-metrics">
          <div class="section">
            <div class="section-title">System Metrics</div>
            <div class="grid">
              <!-- CPU (historic line) -->
              <div class="card">
                <h2><span>CPU Usage</span><span class="pill ok" id="cpu-pill">OK</span></h2>
                <div class="kpi"><div class="value" id="cpu-kpi">--</div><div class="unit">%</div></div>
                <div class="chart-wrap"><canvas id="cpuChart"></canvas></div>
              </div>

              <!-- Memory (historic line) -->
              <div class="card">
                <h2><span>Memory</span><span class="pill ok" id="mem-pill">OK</span></h2>
                <div class="kpi"><div class="value" id="mem-kpi">--</div><div class="unit">%</div></div>
                <div class="chart-wrap"><canvas id="memChart"></canvas></div>
                <div class="progress"><div id="mem-progress"></div></div>
                <div class="progress-meta"><span>Used / Total</span><span id="mem-info">--</span></div>
              </div>

              <!-- Temperature (historic line) -->
              <div class="card">
                <h2><span>Temperature</span><span class="pill ok" id="temp-pill">OK</span></h2>
                <div class="kpi"><div class="value" id="temp-kpi">--</div><div class="unit">¬∞C</div></div>
                <div class="chart-wrap"><canvas id="tempChart"></canvas></div>
              </div>

              <!-- Battery History (historic line) -->
              <div class="card">
                <h2><span>Battery History</span><span class="pill ok" id="battery-pill">HISTORY</span></h2>
                <div class="kpi"><div class="value" id="battery-hist-kpi">--</div><div class="unit">%</div></div>
                <div style="font-size:12px;color:var(--muted);margin:-6px 0 8px 0;" id="battery-estimate-card"></div>
                <div class="chart-wrap"><canvas id="batteryChart"></canvas></div>
              </div>

              <!-- Disk (speedometer-like gauge) -->
              <div class="card">
                <h2><span>Disk</span><span class="pill ok" id="disk-pill">OK</span></h2>
                <div class="chart-wrap gauge-wrap" style="height:220px; position:relative; overflow:visible;">
                  <canvas id="diskGauge"></canvas>
                  <div class="gauge-center">
                    <div class="big"><span id="disk-kpi">--</span>%</div>
                    <div class="small" id="disk-info">--</div>
                  </div>
                </div>
              </div>

              <!-- Network (rate line KB/s) -->
              <div class="card">
                <h2><span>Network</span><span class="pill ok" id="net-pill">OK</span></h2>
                <div class="rows">
                  <div class="stat"><span class="stat-label">IP address</span><span class="stat-value" id="net-ip">--</span></div>
                </div>
                <div class="chart-wrap" style="margin-top:10px"><canvas id="netChart"></canvas></div>
                <div class="rows" id="network-interfaces" style="margin-top:10px"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Controls & Services Window -->
        <div class="window" id="window-controls">
          <div class="section">
            <div class="section-title">Controls & Services</div>
            <div class="grid">
              <!-- Services -->
              <div class="card">
                <h2><span>Services</span><span class="pill ok" id="svc-pill">OK</span></h2>
                <div class="rows" id="services-list">
                  <div class="stat"><span class="stat-label">Loading</span><span class="stat-value">...</span></div>
                </div>
              </div>

              <!-- IPTV -->
              <div class="card">
                <h2><span>IPTV</span><span class="pill ok" id="iptv-pill">OK</span></h2>
                <div id="iptv-content" class="rows">
                  <div class="stat"><span class="stat-label">Username</span><span class="stat-value" id="iptv-username">--</span></div>
                  <div class="stat"><span class="stat-label">Active / Max</span><span class="stat-value" id="iptv-connections">--</span></div>
                  <div class="stat"><span class="stat-label">Status</span><span class="stat-value" id="iptv-status">--</span></div>
                  <div class="stat"><span class="stat-label">Expires</span><span class="stat-value" id="iptv-expires">--</span></div>
                </div>
              </div>

              <!-- Brightness -->
              <div class="card">
                <h2><span>Brightness</span><span class="pill ok" id="bright-pill">CONTROL</span></h2>
                <div class="kpi"><div class="value" id="brightness-kpi">--</div><div class="unit">%</div></div>
                <input type="range" min="0" max="100" value="50" id="brightness-slider">
                <div class="btnrow">
                  <button class="btn" onclick="setBrightness(0)">Min</button>
                  <button class="btn" onclick="setBrightness(50)">50%</button>
                  <button class="btn" onclick="setBrightness(100)">Max</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Tmux Sessions Window -->
        <div class="window" id="window-tmux">
          <div class="section">
            <div class="section-title">Tmux Sessions</div>
            <div class="grid">
              <!-- Tmux Overview -->
              <div class="card">
                <h2><span>Overview</span><span class="pill ok" id="tmux-pill">OK</span></h2>
                <div class="rows">
                  <div class="stat"><span class="stat-label">Total Sessions</span><span class="stat-value" id="tmux-total">--</span></div>
                  <div class="stat"><span class="stat-label">Active Sessions</span><span class="stat-value" id="tmux-active">--</span></div>
                  <div class="stat"><span class="stat-label">Total Windows</span><span class="stat-value" id="tmux-windows">--</span></div>
                  <div class="stat"><span class="stat-label">Total Panes</span><span class="stat-value" id="tmux-panes">--</span></div>
                </div>
              </div>
              
              <!-- Session List -->
              <div class="card" style="grid-column: span 2;">
                <h2><span>Sessions</span></h2>
                <div id="tmux-sessions-list">
                  <div class="stat"><span class="stat-label">Loading...</span><span class="stat-value">--</span></div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Rally Bot Window -->
        <div class="window" id="window-rally">
          <div class="section">
            <div class="section-title">Rally Bot - Station Routes</div>
            
            <!-- Filters -->
            <div class="rally-filters">
              <div class="filter-group">
                <label class="filter-label">Origin Station</label>
                <div class="ms-wrapper" id="ms-origin" data-placeholder="All Origins">
                  <button class="ms-trigger" onclick="toggleMultiSelect('ms-origin', event)">
                    <span class="ms-label">All Origins</span>
                    <span class="ms-chevron">‚ñæ</span>
                  </button>
                  <div class="ms-panel" id="ms-origin-panel">
                    <input class="ms-search" type="text" placeholder="Search‚Ä¶" oninput="filterMsPanel(this)" />
                    <div class="ms-options" id="ms-origin-options"></div>
                  </div>
                </div>
              </div>
              <div class="filter-group">
                <label class="filter-label">Destination</label>
                <div class="ms-wrapper" id="ms-dest" data-placeholder="All Destinations">
                  <button class="ms-trigger" onclick="toggleMultiSelect('ms-dest', event)">
                    <span class="ms-label">All Destinations</span>
                    <span class="ms-chevron">‚ñæ</span>
                  </button>
                  <div class="ms-panel" id="ms-dest-panel">
                    <input class="ms-search" type="text" placeholder="Search‚Ä¶" oninput="filterMsPanel(this)" />
                    <div class="ms-options" id="ms-dest-options"></div>
                  </div>
                </div>
              </div>
              <div class="filter-group">
                <label class="filter-label">Camper Model</label>
                <div class="ms-wrapper" id="ms-model" data-placeholder="All Models">
                  <button class="ms-trigger" onclick="toggleMultiSelect('ms-model', event)">
                    <span class="ms-label">All Models</span>
                    <span class="ms-chevron">‚ñæ</span>
                  </button>
                  <div class="ms-panel" id="ms-model-panel">
                    <input class="ms-search" type="text" placeholder="Search‚Ä¶" oninput="filterMsPanel(this)" />
                    <div class="ms-options" id="ms-model-options"></div>
                  </div>
                </div>
              </div>
              <div class="filter-group" style="flex:2;min-width:220px">
                <label class="filter-label">Date Range</label>
                <div class="ms-wrapper" id="cal-wrapper">
                  <button class="ms-trigger" onclick="toggleCalendar(event)">
                    <span class="ms-label" id="cal-label">Any date</span>
                    <span class="ms-chevron">‚ñæ</span>
                  </button>
                  <div class="ms-panel cal-panel" id="cal-panel">
                    <div class="cal-header">
                      <button class="cal-nav" onclick="calShiftMonth(-1,event)">&#8249;</button>
                      <span class="cal-month-label" id="cal-month-label"></span>
                      <button class="cal-nav" onclick="calShiftMonth(1,event)">&#8250;</button>
                    </div>
                    <div class="cal-weekdays">
                      <span>Mo</span><span>Tu</span><span>We</span><span>Th</span><span>Fr</span><span>Sa</span><span>Su</span>
                    </div>
                    <div class="cal-days" id="cal-days"></div>
                    <div class="cal-footer">
                      <span class="cal-selection-txt" id="cal-selection-txt"></span>
                      <div class="cal-footer-btns">
                        <button class="btn cal-clear-btn" onclick="calClear(event)">Clear</button>
                        <button class="btn cal-apply-btn" onclick="calApply(event)">Apply</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="filter-group filter-group-btn">
                <button class="btn" onclick="clearRallyFilters()">Clear All</button>
              </div>
            </div>

            <!-- Stats -->
            <div class="rally-stats">
              <div class="rally-stat-card">
                <div class="rally-stat-value" id="rally-total-routes">--</div>
                <div class="rally-stat-label">Total Routes</div>
              </div>
              <div class="rally-stat-card">
                <div class="rally-stat-value" id="rally-total-returns">--</div>
                <div class="rally-stat-label">Available Returns</div>
              </div>
            </div>

            <!-- Routes List -->
            <div id="rally-routes-container" class="rally-routes">
              <div class="loading-message">Loading routes...</div>
            </div>
          </div>
        </div>
        <!-- Terminal Window -->
        <div class="window" id="window-terminal">
          <div class="section">
            <div class="section-title">Terminal</div>

            <!-- Lock screen -->
            <div id="term-lock">
              <div class="term-lock-box">
                <div class="term-lock-icon">üîí</div>
                <div class="term-lock-title">Authentication required</div>
                <div class="term-lock-sub">Enter the terminal password to continue</div>
                <form id="term-login-form" onsubmit="termLogin(event)" autocomplete="off">
                  <input class="term-password-input" type="password" id="term-password" placeholder="Password" autofocus />
                  <button class="btn term-login-btn" type="submit">Unlock</button>
                </form>
                <div id="term-login-error" class="term-login-error"></div>
              </div>
            </div>

            <!-- Terminal UI (shown after auth) -->
            <div id="term-ui" style="display:none;">
              <div class="term-topbar">
                <span id="term-cwd" class="term-cwd">~</span>
                <button class="btn term-logout-btn" onclick="termLogout()">üîí Lock</button>
              </div>
              <div class="term-body" id="term-body"></div>
              <div class="term-input-row">
                <span class="term-prompt" id="term-prompt">$</span>
                <input class="term-input" id="term-input" type="text"
                  placeholder="Enter command‚Ä¶"
                  autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"
                  onkeydown="termKeydown(event)" />
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="footer">Auto-refresh every 5 seconds</div>
  </div>

  <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>
